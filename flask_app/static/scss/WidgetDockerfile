FROM node:12-slim AS builder

WORKDIR /aqqru-website
COPY yarn.lock package.json ./
COPY widgets/package.json ./widgets/
RUN cd widgets/ && yarn install --focus --prod && yarn cache clean

COPY . .
RUN yarn workspace widgets build

FROM nginx:1.21
COPY widgets/nginx.conf /etc/nginx/conf.d/default.conf
COPY --from=builder /aqqru-website/static /usr/share/nginx/html

